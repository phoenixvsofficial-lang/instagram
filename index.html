<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Phoenix Vape & Coffee | Link Bio</title>

  <link rel="icon" href="logo.png" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --phoenix-orange:#ff6b35;
      --phoenix-amber:#ff9f43;
      --phoenix-red:#ff0000;
      --phoenix-cyan:#00f2ea;
      --phoenix-green:#25d366;
      --glass-bg:rgba(255,255,255,.05);
      --glass-border:rgba(255,255,255,.2);
      --bottom-gap:160px; /* untuk jaga jarak dari tombol/ footer */
      --top-lift:25px;    /* geser konten agak ke atas */
    }

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Poppins',sans-serif;
      background:#000; color:#fff;
      min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
      padding:20px; padding-bottom:calc(var(--bottom-gap) + 40px);
      position:relative; overflow-x:hidden;
    }
    body.noscroll{overflow:hidden;}

    /* === Ember Canvas Global === */
    #emberCanvas{
      position:fixed; inset:0; width:100%; height:100%;
      z-index:-1; pointer-events:none; background:#000;
    }

    /* === Hero === */
    .hero{ text-align:center; margin:10px 0 20px; z-index:2; position:relative; top:calc(-1*var(--top-lift)); }
    .hero img{
      width:120px; border-radius:50%;
      border:5px solid var(--phoenix-orange);
      padding:8px;
      box-shadow:0 0 25px rgba(255,107,53,.8), 0 0 60px rgba(255,107,53,.4);
      animation:glowPulse 3s ease-in-out infinite, heroFadeIn 1s ease forwards;
      margin-bottom:12px; opacity:0; transform:translateY(-30px);
    }
    .hero h1{
      font-family:'Playfair Display',serif; font-size:2rem;
      color:var(--phoenix-orange); text-shadow:0 0 18px rgba(255,107,53,.85);
      margin-bottom:6px; opacity:0; transform:translateY(-20px);
      animation:heroFadeIn 1s ease .3s forwards;
    }
    .hero p{
      color:#ccc; margin-top:2px; font-size:.95rem;
      opacity:0; transform:translateY(-10px);
      animation:heroFadeIn 1s ease .6s forwards;
    }
    @keyframes glowPulse{
      0%,100%{box-shadow:0 0 20px rgba(255,107,53,.6),0 0 60px rgba(255,140,70,.3)}
      50%{box-shadow:0 0 35px rgba(255,140,70,.9),0 0 90px rgba(255,140,70,.5)}
    }
    @keyframes heroFadeIn{to{opacity:1; transform:translateY(0);}}

    /* === Social Buttons === */
    .social{
      display:flex; flex-direction:column; gap:16px;
      margin:6px 0; width:100%; max-width:420px; z-index:2;
      position:relative; top:calc(-1*var(--top-lift));
    }
    .social a{
      display:flex; align-items:center; justify-content:center; gap:10px;
      padding:16px; border-radius:14px; text-decoration:none; font-weight:600;
      font-size:1rem; color:#fff; background:var(--glass-bg);
      border:1px solid var(--glass-border); backdrop-filter:blur(14px);
      -webkit-backdrop-filter:blur(14px);
      transition:.3s; position:relative; overflow:hidden;
      opacity:0; transform:translateX(-60px);
      animation:socialSlideIn .8s ease forwards;
    }
    .social a i{font-size:1.2rem;}
    .social a:nth-child(1){animation-delay:1s;}
    .social a:nth-child(2){animation-delay:1.3s;}
    .social a:nth-child(3){animation-delay:1.6s;}
    .social a:nth-child(4){animation-delay:1.9s;}
    .social a:nth-child(5){animation-delay:2.2s;}
    @keyframes socialSlideIn{to{opacity:1; transform:translateX(0);}}

    .youtube{border:1px solid var(--phoenix-red);}
    .tiktok{border:1px solid var(--phoenix-cyan);}
    .website,.email{border:1px solid var(--phoenix-amber);}
    .whatsapp{border:1px solid var(--phoenix-green);}

    /* === Branch Button === */
    .btn-branch{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:calc(50px + env(safe-area-inset-bottom,0));
      background:linear-gradient(135deg,#ff6b35,#ff9f43);
      border:none; padding:16px; border-radius:14px; font-size:1rem; font-weight:600;
      cursor:pointer; color:#fff; width:90%; max-width:420px;
      transition:.3s; box-shadow:0 0 16px rgba(255,107,53,.45);
      z-index:1002; animation:slideUp 1s ease 3s forwards; opacity:0;
    }
    @keyframes slideUp{to{opacity:1;}}

    /* === Popup === */
    .popup-overlay{
      position:fixed; inset:0; display:flex;
      align-items:flex-end; justify-content:center;
      background:rgba(0,0,0,.65); backdrop-filter:blur(10px);
      z-index:2000; opacity:0; pointer-events:none; transition:opacity .4s;
    }
    .popup-overlay.active{opacity:1; pointer-events:auto;}

    .popup{
      background:linear-gradient(160deg,rgba(15,15,15,.95),rgba(30,20,15,.95));
      backdrop-filter:blur(16px); -webkit-backdrop-filter:blur(16px);
      padding:0 0 18px;
      border-radius:20px 20px 0 0;
      width:100%; max-height:70vh;
      overflow:hidden;
      position:relative;
      transform:translateY(100%); transition:transform .4s ease;
      box-shadow:0 -8px 40px rgba(255,107,53,.35);
      will-change:transform;
    }
    .popup.active{transform:translateY(0);}

    #popupEmber{
      position:absolute; inset:0; width:100%; height:100%;
      z-index:0; pointer-events:none;
    }

    /* Glow bar di atas popup */
    .topbar{
      height:3px;
      background:linear-gradient(90deg,var(--phoenix-orange),var(--phoenix-amber),var(--phoenix-orange));
      background-size:200% 100%;
      animation:glowBar 3s linear infinite;
      position:relative;
      z-index:2;
      border-radius:20px 20px 0 0;
    }
    @keyframes glowBar{0%{background-position:0 0;}100%{background-position:200% 0;}}

    .popup-content{
      position:relative; z-index:3;
      max-height:calc(70vh - 3px);
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      padding:16px 16px 16px;
      isolation:isolate; background:transparent;
    }

    .popup-content::after{
      content:"";
      position:sticky; bottom:-1px;
      left:0; right:0;
      height:24px;
      background:linear-gradient(to top, rgba(0,0,0,.9), transparent);
      pointer-events:none;
    }

    .popup .indicator{
      width:50px; height:5px;
      background:rgba(255,255,255,.2);
      border-radius:3px;
      margin:10px auto 12px;
    }

    .popup .close{
      position:absolute; top:10px; right:18px; background:none;
      border:none; font-size:1.6rem; color:#fff; cursor:pointer; z-index:5;
    }

    /* === Popup header === */
    .popup-header{
      text-align:center;
      margin:4px 0 12px;
    }
    .popup-header h2{
      color:var(--phoenix-amber);
      font-size:1.2rem;
      margin-bottom:4px;
    }
    .popup-header p{
      font-size:.85rem;
      color:#ccc;
    }

    /* === Search bar === */
    .branch-search-wrap{
      display:flex; align-items:center; gap:8px;
      margin:8px 0 12px;
      padding:8px 10px;
      border-radius:12px;
      background:rgba(0,0,0,.6);
      border:1px solid rgba(255,255,255,.12);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
    }
    .branch-search-wrap i{
      font-size:.9rem; color:var(--phoenix-amber);
    }
    #branchSearch{
      flex:1; background:transparent;
      border:none; outline:none;
      color:#fff; font-size:.9rem;
    }
    #branchSearch::placeholder{
      color:#888; font-size:.85rem;
    }

    /* === Store list === */
    .store-list{
      display:flex; flex-direction:column; gap:8px;
      margin-bottom:10px;
    }

    .popup .store-btn{
      display:flex; align-items:center; gap:10px;
      background:var(--glass-bg);
      border:1px solid var(--glass-border);
      backdrop-filter:blur(14px); -webkit-backdrop-filter:blur(14px);
      padding:14px 16px; border-radius:12px;
      color:#fff; font-weight:600; text-decoration:none;
      transition:.3s;
      opacity:0; transform:translateX(-60px);
      animation:storeSlideIn .75s ease forwards;
    }
    .popup .store-btn i{
      font-size:1.2rem; color:var(--phoenix-amber);
    }
    .popup .store-btn:hover{
      background:rgba(255,107,53,.25);
      color:var(--phoenix-amber);
      transform:translateX(0) translateY(-2px);
      box-shadow:0 0 12px rgba(255,107,53,.4);
    }
    @keyframes storeSlideIn{to{opacity:1; transform:translateX(0);} }

    /* === Desktop 2 kolom === */
    @media (min-width:600px){
      .store-list{
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:10px;
      }
      .popup{
        max-width:520px;
        border-radius:24px;
        margin-bottom:24px;
      }
      .topbar{
        border-radius:24px 24px 0 0;
      }
      .popup-overlay{
        align-items:center;
      }
    }

    /* === Footer === */
    footer{
      position:fixed; bottom:0; left:0; right:0; padding:12px 0;
      background:rgba(0,0,0,.8); backdrop-filter:blur(6px);
      border-top:1px solid rgba(255,255,255,.08);
      text-align:center; font-size:.85rem; color:#777; z-index:1000;
      padding-bottom:calc(12px + env(safe-area-inset-bottom,0));
    }
    footer::before{
      content:""; position:absolute; top:0; left:50%; transform:translateX(-50%);
      width:80%; height:2px; background:linear-gradient(90deg,transparent,var(--phoenix-orange),transparent);
    }
  </style>
</head>
<body>
  <canvas id="emberCanvas"></canvas>

  <div class="hero">
    <img src="logo.png" alt="Phoenix Logo">
    <h1>Phoenix Vape & Coffee</h1>
    <p>üö¨ Vape Premium | ‚òï Coffee Hangout | üéâ Event Seru</p>
  </div>

  <div class="social">
    <a href="https://www.youtube.com/@PhoenixOfficial-r6j" class="youtube"><i class="fab fa-youtube"></i> YouTube</a>
    <a href="https://www.tiktok.com/@phoenixvs.official" class="tiktok"><i class="fab fa-tiktok"></i> TikTok</a>
    <a href="https://phoenixvape.co.id/" class="website" target="_blank" rel="noopener noreferrer"><i class="fas fa-globe"></i> Website</a>

    <!-- EMAIL langsung mailto -->
    <a href="mailto:phoenixvsofficial@gmail.com" class="email">
      <i class="fas fa-envelope"></i> Email
    </a>

    <!-- WHATSAPP langsung wa.me (tanpa JS) -->
    <a
      href="https://wa.me/6282145929380?text=Hai%20Phoenix%2C%20saya%20tertarik%20dengan%20produk%20Phoenix%2C%20boleh%20info%20lebih%20lanjut%3F"
      class="whatsapp"
      id="whatsappBtn"
      target="_blank"
      rel="noopener noreferrer">
      <i class="fab fa-whatsapp"></i> WhatsApp
    </a>
  </div>

  <button class="btn-branch" id="openPopup">üìç Lokasi Cabang</button>

  <!-- Popup -->
  <div class="popup-overlay" id="popupOverlay" aria-hidden="true">
    <div class="popup" id="popupBox" aria-modal="true" role="dialog">
      <canvas id="popupEmber"></canvas>
      <div class="topbar"></div>

      <div class="popup-content" id="popupContent">
        <div class="indicator"></div>
        <button class="close" id="closePopup" aria-label="Tutup">‚úñ</button>

        <div class="popup-header">
          <h2>üìç Lokasi Cabang Phoenix</h2>
          <p>Tap salah satu cabang untuk langsung buka Google Maps. Tarik ke bawah untuk menutup.</p>
        </div>

        <div class="branch-search-wrap">
          <i class="fa-solid fa-magnifying-glass"></i>
          <input
            type="text"
            id="branchSearch"
            placeholder="Cari cabang: Pluit, Ceger, Ciledug, dsb."
            autocomplete="off"
          />
        </div>

        <div class="store-list">
          <!-- DATA CABANG TETAP -->
          <a href="https://maps.app.goo.gl/Y8GifwrGXPv5HLpY6?g_st=ipc" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 1 - Alam Sutera</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Roxy" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 2 - Roxy</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Pademangan" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 3 - Pademangan</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Jembatan+Besi" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 5 - Jembatan Besi</span>
          </a>
          <a href="https://maps.app.goo.gl/D72zZYGnVe4GAE1o6?g_st=ipc" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 6 - Binus Center</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Raden+Saleh" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 7 - Raden Saleh</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Ciledug" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 8 - Ciledug</span>
          </a>
          <a href="https://maps.app.goo.gl/KbGqkM7eVME5Qn4w9?g_st=iw" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 9 - Ceger</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Pluit" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 11 - Pluit</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Mangga+Besar" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 13 - Mangga Besar</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Lokasari" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 18 - Lokasari</span>
          </a>
          <a href="https://maps.google.com/?q=Phoenix+Vape+Coffee+Untar" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Store 68 - Untar</span>
          </a>
          <a href="https://maps.app.goo.gl/YxZg64DipCcvTbcs8?g_st=ic" target="_blank" rel="noopener noreferrer" class="store-btn">
            <i class="fa-solid fa-location-dot"></i>
            <span class="store-name">Boot BSD - BSD B residence</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <footer>¬© 2025 Phoenix Vape & Coffee</footer>

  <script>
    /* ======= Popup open/close ======= */
    const popupOverlay = document.getElementById('popupOverlay');
    const popupBox = document.getElementById('popupBox');
    const popupContent = document.getElementById('popupContent');
    const openPopup = document.getElementById('openPopup');
    const closePopup = document.getElementById('closePopup');
    const branchSearch = document.getElementById('branchSearch');

    let isOpen=false, isAnimating=false;

    function openPop(){
      if(isOpen||isAnimating) return;
      isAnimating=true;
      popupOverlay.classList.add('active');
      document.body.classList.add('noscroll');
      void popupBox.offsetHeight;
      popupBox.classList.add('active');
      popupOverlay.setAttribute('aria-hidden','false');

      // reset search tiap buka
      if(branchSearch){
        branchSearch.value='';
        branchSearch.dispatchEvent(new Event('input'));
      }

      popupBox.querySelectorAll('.store-btn').forEach((b,i)=>{
        b.style.animationDelay=(0.2+i*0.08)+'s';
      });

      startPopupEmber();
    }

    function closePop(){
      if(!isOpen||isAnimating) return;
      isAnimating=true;
      popupBox.classList.remove('active');
    }

    popupBox.addEventListener('transitionend',(e)=>{
      if(e.propertyName!=='transform') return;
      if(popupBox.classList.contains('active')){
        isOpen=true; isAnimating=false;
        popupBox.style.transform='';
      }else{
        popupOverlay.classList.remove('active');
        popupOverlay.setAttribute('aria-hidden','true');
        document.body.classList.remove('noscroll');
        popupBox.style.transform='translateY(100%)';
        void popupBox.offsetHeight; popupBox.style.transform='';
        isOpen=false; isAnimating=false;
        stopPopupEmber();
      }
    });

    openPopup.addEventListener('click', openPop);
    closePopup.addEventListener('click', closePop);
    popupOverlay.addEventListener('click', (e)=>{ if(e.target===popupOverlay) closePop(); });
    document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'&&isOpen&&!isAnimating) closePop(); });

    /* ===== Swipe-to-close ===== */
    let startY=0, deltaY=0, dragging=false, canDrag=false;

    popupBox.addEventListener('touchstart',(e)=>{
      if(!isOpen||isAnimating) return;
      startY = e.touches[0].clientY;
      deltaY = 0;
      canDrag = (popupContent.scrollTop <= 0);
    }, {passive:true});

    popupBox.addEventListener('touchmove',(e)=>{
      if(!isOpen||isAnimating) return;
      const currentY = e.touches[0].clientY;
      deltaY = currentY - startY;

      if(canDrag && deltaY > 0){
        if(!dragging){
          dragging = true;
          popupBox.classList.add('dragging');
          popupOverlay.classList.add('dragging');
          pausePopupEmber();
        }
        e.preventDefault();
        popupBox.style.transform = `translateY(${deltaY}px)`;
      }
    }, {passive:false});

    popupBox.addEventListener('touchend',()=>{
      if(!isOpen||isAnimating) return;
      const threshold = 160;
      if(dragging && deltaY > threshold){
        popupBox.style.transform='';
        dragging=false;
        popupBox.classList.remove('dragging'); popupOverlay.classList.remove('dragging');
        closePop();
      }else{
        popupBox.style.transition='transform .25s ease';
        popupBox.style.transform='translateY(0)';
        setTimeout(()=>{
          popupBox.style.transition=''; popupBox.style.transform='';
          dragging=false;
          popupBox.classList.remove('dragging'); popupOverlay.classList.remove('dragging');
          resumePopupEmber();
        },250);
      }
      startY=0; deltaY=0; canDrag=false;
    });

    /* ===== Pencarian cabang ===== */
    if(branchSearch){
      const storeButtons = Array.from(popupBox.querySelectorAll('.store-btn'));
      branchSearch.addEventListener('input', ()=>{
        const term = branchSearch.value.trim().toLowerCase();
        storeButtons.forEach(btn=>{
          const text = btn.textContent.toLowerCase();
          btn.style.display = (!term || text.includes(term)) ? 'flex' : 'none';
        });
      });
    }

    /* ======= Ember background global ======= */
    const canvas = document.getElementById('emberCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let viewW = 0, viewH = 0;

    function resizeGlobal(){
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      viewW = window.innerWidth; viewH = window.innerHeight;
      canvas.width = Math.floor(viewW * dpr);
      canvas.height = Math.floor(viewH * dpr);
      canvas.style.width = viewW + 'px';
      canvas.style.height = viewH + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener('resize', resizeGlobal);
    resizeGlobal();

    class Particle{
      constructor(type='ember'){ this.type=type; this.reset(true); }
      reset(initial=false){
        this.x = Math.random()*viewW;
        this.y = initial ? (Math.random()*viewH) : (viewH + Math.random()*200);
        this.size = this.type==='ember' ? (Math.random()*4+2) : (Math.random()*2+1);
        this.speedY = this.type==='ember' ? (Math.random()*1.5+0.5) : (Math.random()*0.8+0.3);
        this.alpha = Math.random()*0.5+0.5;
        this.color = (this.type==='ember') ? (Math.random()>0.5?'255,120,50':'255,200,50') : '255,255,200';
        this.wind = (Math.random()-0.5)*0.5;
      }
      update(){
        this.y -= this.speedY;
        this.x += this.wind;
        if (this.y < -10) this.reset(false);
      }
      draw(){
        const r = this.size*3;
        const g = ctx.createRadialGradient(this.x,this.y,0,this.x,this.y,r);
        g.addColorStop(0,`rgba(${this.color},${this.alpha})`);
        g.addColorStop(1,`rgba(${this.color},0)`);
        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(this.x,this.y,r,0,Math.PI*2);
        ctx.fill();
      }
    }

    function initParticles(){
      particles = [];
      for(let i=0;i<80;i++) particles.push(new Particle('ember'));
      for(let i=0;i<40;i++) particles.push(new Particle('spark'));
    }
    function animateGlobal(){
      ctx.clearRect(0,0,viewW,viewH);
      particles.forEach(p=>{p.update();p.draw();});
      requestAnimationFrame(animateGlobal);
    }
    initParticles();
    animateGlobal();

    /* ======= Ember khusus popup ======= */
    const popupCanvas = document.getElementById('popupEmber');
    const pctx = popupCanvas.getContext('2d');
    let pParticles = [];
    let popupAF = null;
    let popW = 0, popH = 0;

    function resizePopupCanvas(){
      const dpr = Math.min(window.devicePixelRatio || 1, 2);
      popW = popupBox.clientWidth; popH = popupBox.clientHeight;
      popupCanvas.width = Math.floor(popW * dpr);
      popupCanvas.height = Math.floor(popH * dpr);
      popupCanvas.style.width = popW + 'px';
      popupCanvas.style.height = popH + 'px';
      pctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    class PopupParticle{
      constructor(type='ember'){ this.type=type; this.reset(true); }
      reset(initial=false){
        this.x = Math.random()*popW;
        this.y = initial ? (Math.random()*popH) : (popH + 50);
        this.size = this.type==='ember' ? (Math.random()*3+1) : (Math.random()*1.5+0.5);
        this.speedY = this.type==='ember' ? (Math.random()*1+0.3) : (Math.random()*0.5+0.2);
        this.alpha = Math.random()*0.5+0.5;
        this.color = this.type==='ember' ? (Math.random()>0.5?'255,120,50':'255,200,50') : '255,255,200';
        this.wind = (Math.random()-0.5)*0.4;
      }
      update(){
        this.y -= this.speedY;
        this.x += this.wind;
        if(this.y < -10) this.reset(false);
      }
      draw(){
        const r = this.size*3;
        const g = pctx.createRadialGradient(this.x,this.y,0,this.x,this.y,r);
        g.addColorStop(0,`rgba(${this.color},${this.alpha})`);
        g.addColorStop(1,`rgba(${this.color},0)`);
        pctx.fillStyle = g;
        pctx.beginPath();
        pctx.arc(this.x,this.y,r,0,Math.PI*2);
        pctx.fill();
      }
    }

    function initPopupParticles(){
      pParticles = [];
      for(let i=0;i<40;i++) pParticles.push(new PopupParticle('ember'));
      for(let i=0;i<20;i++) pParticles.push(new PopupParticle('spark'));
    }

    function loopPopup(){
      pctx.clearRect(0,0,popW,popH);
      pParticles.forEach(p=>{p.update();p.draw();});
      popupAF = requestAnimationFrame(loopPopup);
    }

    function startPopupEmber(){
      resizePopupCanvas();
      initPopupParticles();
      if (popupAF) cancelAnimationFrame(popupAF);
      popupAF = requestAnimationFrame(loopPopup);
      window.addEventListener('resize', resizePopupCanvas);
    }
    function stopPopupEmber(){
      if (popupAF) cancelAnimationFrame(popupAF);
      popupAF = null;
      pctx.clearRect(0,0,popW,popH);
      window.removeEventListener('resize', resizePopupCanvas);
    }
    function pausePopupEmber(){
      if (popupAF) { cancelAnimationFrame(popupAF); popupAF = null; }
    }
    function resumePopupEmber(){
      if (!popupAF && isOpen) { popupAF = requestAnimationFrame(loopPopup); }
    }

    /* ======= Dynamic bottom-gap ======= */
    function updateBottomGap(){
      const btn = document.getElementById('openPopup');
      const footer = document.querySelector('footer');
      const btnH = btn ? btn.offsetHeight : 68;
      const footH = footer ? footer.offsetHeight : 36;
      const buffer = 24;
      const gap = btnH + footH + buffer;
      document.documentElement.style.setProperty('--bottom-gap', gap + 'px');
    }
    window.addEventListener('load', updateBottomGap);
    window.addEventListener('resize', updateBottomGap);
    if (document.fonts && document.fonts.ready) {
      document.fonts.ready.then(updateBottomGap);
    }
  </script>
</body>
</html>
